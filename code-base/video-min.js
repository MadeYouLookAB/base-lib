class VideoLibrary{constructor(e={}){this.options={rootMargin:e.rootMargin||"0px",threshold:e.threshold||.05,scrollTriggerThreshold:e.scrollTriggerThreshold||.5,debug:e.debug||!1,...e},this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.videoObserver=null,this.scrollObservers=new Map,this.pictureElementCache=new WeakMap,this.eventListeners=new WeakMap,this.resizeHandler=null,this.resizeTimeout=null,this.init()}init(){0!==document.querySelectorAll("video[data-video]").length&&(this.prefersReducedMotion&&console.log("User prefers reduced motion. Videos will not auto-play."),this.removeDesktopOnlyVideos(),this.setupLazyLoading(),this.setupVideoControls(),this.setupHoverPlay(),document.querySelectorAll('video[data-video-desktop-only="true"]').length>0&&(this.resizeHandler=()=>{this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.removeDesktopOnlyVideos()},150)},window.addEventListener("resize",this.resizeHandler)))}getComponentContainer(e){return e.closest('[data-video="component"]')||e.parentElement||null}removeDesktopOnlyVideos(){var e=document.querySelectorAll('video[data-video-desktop-only="true"]');let t=window.innerWidth<=991;e.forEach(e=>{var i=this.getComponentContainer(e);i=i?i.querySelector('[data-video-playback="wrapper"]'):null,t?(e.style.display="none",this.showPictureElement(e),i&&(i.style.display="none",i.style.visibility="hidden",i.setAttribute("aria-hidden","true"))):(e.style.display="",this.hidePictureElement(e),i&&(i.style.display="",i.style.visibility="",i.setAttribute("aria-hidden","false")))})}setupLazyLoading(){var e,t=document.querySelectorAll("video[data-video]");0!==t.length&&(e={root:null,rootMargin:this.options.rootMargin,threshold:this.options.threshold},this.videoObserver=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){let i=e.target;this.lazyLoadVideo(i).then(()=>t.unobserve(i)).catch(console.error)}})},e),t.forEach(e=>{var t="true"===e.getAttribute("data-video-scroll-in-play"),i="true"===e.getAttribute("data-video-hover");this.videoObserver.observe(e),i&&t?this.setupScrollInPlayForHover(e):i||(this.prefersReducedMotion?e.pause():t?this.setupScrollInPlay(e):this.setupAutoplay(e))}))}lazyLoadVideo(e){return new Promise((t,i)=>{let r=e.querySelector("source[data-src]");r&&!r.src?(r.src=r.getAttribute("data-src"),e.load(),e.addEventListener("canplaythrough",function i(){e.removeEventListener("canplaythrough",i),t()}),e.addEventListener("error",function t(){e.removeEventListener("error",t),i(new Error("Error loading video: "+r.src))})):t()})}showPictureElement(e){(e=this.findPictureElement(e))&&(e.style.display="block")}hidePictureElement(e){(e=this.findPictureElement(e))&&(e.style.display="none")}findPictureElement(e){if(this.pictureElementCache.has(e))return this.pictureElementCache.get(e);let t=null,i=e.previousElementSibling;for(;i;){if("PICTURE"===i.tagName||"IMG"===i.tagName){t=i;break}i=i.previousElementSibling}var r;return!t&&(r=this.getComponentContainer(e))&&(t=r.querySelector("picture, img")),this.pictureElementCache.set(e,t),t}setupVideoControls(){document.querySelectorAll("video[data-video]").forEach(e=>{this.handlePlaybackButtons(e)})}setupHoverPlay(){document.querySelectorAll('video[data-video-hover="true"]').forEach(e=>{var t,i=this.getComponentContainer(e),r=i||e;let o=!1;r&&(this.showPictureElement(e),i&&(i=i.querySelector('[data-video-playback="button"]'))&&(i.setAttribute("aria-hidden","true"),i.setAttribute("tabindex","-1")),i=()=>{e.pause()},r.addEventListener("mouseenter",t=async()=>{if(!this.prefersReducedMotion)try{this.hidePictureElement(e),await this.lazyLoadVideo(e),o||(e.currentTime=0,o=!0),e.play()}catch(e){console.error("Error playing hover video:",e)}}),r.addEventListener("mouseleave",i),this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push({element:r,type:"mouseenter",handler:t},{element:r,type:"mouseleave",handler:i}))})}setupAutoplay(e){e.addEventListener("canplaythrough",()=>{this.prefersReducedMotion||(this.hidePictureElement(e),e.play().catch(console.error))})}setupScrollInPlay(e){let t=!1;var i=new IntersectionObserver(i=>{for(var r of i)r.isIntersecting?this.lazyLoadVideo(e).then(()=>{this.prefersReducedMotion||(this.hidePictureElement(e),t||(e.currentTime=0,t=!0),e.play())}).catch(console.error):e.pause()},{threshold:this.options.scrollTriggerThreshold});i.observe(e),this.scrollObservers.set(e,i)}setupScrollInPlayForHover(e){var t=new IntersectionObserver(t=>{for(var i of t)i.isIntersecting&&this.lazyLoadVideo(e).then(()=>{e.pause(),this.showPictureElement(e)}).catch(console.error)},{threshold:this.options.scrollTriggerThreshold});t.observe(e),this.scrollObservers.set(e,t)}handlePlaybackButtons(e){if(t=this.getComponentContainer(e)){let o=t.querySelector('[data-video-playback="button"]');if(o){let s=o.querySelector('[data-video-playback="play"]'),n=o.querySelector('[data-video-playback="pause"]');if(s&&n){let a=e=>{e?(s.style.display="none",s.style.visibility="hidden",s.setAttribute("aria-hidden","true"),n.style.display="flex",n.style.visibility="visible",n.setAttribute("aria-hidden","false"),o.setAttribute("aria-label","Pause video")):(s.style.display="flex",s.style.visibility="visible",s.setAttribute("aria-hidden","false"),n.style.display="none",n.style.visibility="hidden",n.setAttribute("aria-hidden","true"),o.setAttribute("aria-label","Play video"))};a(!e.paused);var t=async t=>{if(t.stopPropagation(),e.paused)try{await this.lazyLoadVideo(e),this.hidePictureElement(e),e.play(),a(!0)}catch(t){console.error(t)}else e.pause(),a(!1)},i=()=>a(!0),r=()=>a(!1);o.addEventListener("click",t),e.addEventListener("play",i),e.addEventListener("pause",r),this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push({element:o,type:"click",handler:t},{element:e,type:"play",handler:i},{element:e,type:"pause",handler:r})}}}}async playVideo(e){var t=document.querySelector(`video[data-video="${e}"]`);if(t)try{await this.lazyLoadVideo(t),this.prefersReducedMotion||(this.hidePictureElement(t),t.currentTime=0,t.play())}catch(t){console.error(`Error playing video ${e}:`,t)}else console.warn(`Video with id "${e}" not found`)}pauseVideo(e){var t=document.querySelector(`video[data-video="${e}"]`);t?t.pause():console.warn(`Video with id "${e}" not found`)}pauseAllVideos(){document.querySelectorAll("video[data-video]").forEach(e=>{e.pause()})}destroy(){this.videoObserver&&this.videoObserver.disconnect(),this.scrollObservers.forEach(e=>{e.disconnect()}),this.scrollObservers.clear(),this.eventListeners.forEach(e=>{e.forEach(({element:e,type:t,handler:i})=>{e.removeEventListener(t,i)})}),this.eventListeners=new WeakMap,this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.pictureElementCache=new WeakMap}reinitialize(){this.destroy(),this.init()}}function initializeVideoLibrary(){document.querySelectorAll("video[data-video]").length>0?window.videoLibrary=new VideoLibrary:window.VideoLibraryConfig?.debug&&console.log("VideoLibrary: No videos detected, skipping auto-initialization.")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeVideoLibrary):initializeVideoLibrary(),"undefined"!=typeof module&&module.exports&&(module.exports=VideoLibrary);